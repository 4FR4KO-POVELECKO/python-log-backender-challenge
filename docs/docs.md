
# Архитектурные решения
В данном решении реализована система регистрации событий. Создаётся запись события в базе данных PostgreSQL. Фоновая задача(Celery) периодически извлекает эти события, отправляет их в аналитическую базу данных ClickHouse, а затем удаляет успешно обработанные события из PostgreSQL.

При создании пользователя событие записывается в отдельную таблицу, 
что освобождает основной процесс от дополнительной нагрузки по обработке аналитики.

Для обработки событий используется Celery. Задачи Celery позволяют извлекать события из базы данных и выполнять длительные операции (например, вставку в ClickHouse) асинхронно.

# Техническая реализация
При создании пользователя генерируется событие, которое записывается в таблицу EventLog. Запись события содержит следующие поля:
- type – тип события (например, user_created)
- created_at – дата и время создания события
- environment – окружение (например, Local или Production)
- context – дополнительные данные в формате JSON (например, данные пользователя)

Фоновая задача реализованная с помощюь Celery, выполняет следующие шаги:
- Извлечение событий:
    Из базы PostgreSQL извлекается ограниченный набор событий (например, пакет из N записей) с использованием блокировки (select_for_update(skip_locked=True)). Колличество событий объявляется в настройке EVENT_BATCH_SIZE
- Отправка в ClickHouse:
    События преобразуются в необходимый формат и отправляются через специализированный клиент (EventLogClient).
    Для ClickHouse клиент (EventLogClickhouseClient). В случае добавления нового клиента необходимо создать новый класс в client.py, реализовать методы (init, insert, query), в services.py добавить обработку EventLog в PROCESS_METHOD.
- Удаление обработанных событий:
    После успешной вставки событий в ClickHouse, идентификаторы обработанных событий используются для удаления соответствующих записей из PostgreSQL.
- Логирование:
    Все этапы обработки, а также возможные ошибки, логируются для последующего мониторинга и отладки(Sentry, structlog).
